---
title: "abundance-nasa1"
output: html_document
date: "2025-08-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(readr)
SWD_data <- read_csv("C:/Users/maria/OneDrive/Desktop/abundance-nasa/NEW CLEAN EXCEL Nunez SWD Sorting Sheet June 2024 for abundance-nasa(Data).csv")
```

```{r}
#NOT WORKING
#Create a subset of the SWD data for just VT
SWD_dataVT<-subset(SWD_data, SWD_data$Coordinates== c("44.5147926,-72.926916", "44.265172,-73.1334011", "44.2661258,-73.1014259", "44.2893745,-73.2420434", "44.29804,-73.1885194"))
#Create a subset of the SWD data for just VA
SWD_dataVA<-subset(SWD_data, SWD_data$site== c("38.0408,-84.6058","37.9740223,-78.5447915","38.0672129,-78.7471497","38.0624585,-78.4638626","36.6500994,-80.6151617","39.1003535,-77.8162521","38.3597327,-78.842056"))
```


```{r}
library(nasapower)
library(tidyverse)
library(magrittr)
library(ggplot2)
```

```{r}
SweetRoots_weather <- get_power(# choose name; get_power is function from nasapower package
  # i think
  community = "ag",
  lonlat = c(44.2893745,-73.2420434),# location of data
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", # dates of data
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"# frequency of measurements
)
AdamsBerry_weather <- get_power(
  community = "ag",
  lonlat = c(44.29804,-73.1885194),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
FullBelly_weather <- get_power(
  community = "ag",
  lonlat = c(44.265172,-73.1334011),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
LastResort_weather <- get_power(
  community = "ag",
  lonlat = c(44.2661258,-73.1014259),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
CoveredBridge_weather <- get_power(
  community = "ag",
  lonlat = c(44.5147926,-72.926916),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
```

```{r}
LexingtonBluegrass_weather <- get_power(
  community = "ag",
  lonlat = c(38.0408,-84.6058),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2020-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
CartersMountain_weather <- get_power(
  community = "ag",
  lonlat = c(37.9740223,-78.5447915),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2017-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
ChilesPeachOrchard_weather <- get_power(
  community = "ag",
  lonlat = c( 38.0672129,-78.7471497),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
LeveringOrchard_weather <- get_power(
  community = "ag",
  lonlat = c(36.6500994,-80.6151617),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
CharlottesvilleAlbermarle_weather <- get_power(
  community = "ag",
  lonlat = c(38.0624585,-78.4638626),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
GreatCountryFarms_weather <- get_power(
  community = "ag",
  lonlat = c(39.1003535,-77.8162521),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
CrossKeysFarm_weather <- get_power(
  community = "ag",
  lonlat = c(38.3597327,-78.842056),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2022-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
```

```{r}
AlBe_weather <- get_power(
  community = "ag",
  lonlat = c(38.146223,-79.081904),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
KiBa_weather <- get_power(
  community = "ag",
  lonlat = c(37.8929361,-79.017840),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
JoNu_weather <- get_power(
  community = "ag",
  lonlat = c(38.0783378,-78.488982),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
FeAb_weather <- get_power(
  community = "ag",
  lonlat = c(37.97985,-78.48961),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
RaPo_weather <- get_power(
  community = "ag",
  lonlat = c(37.9778276,-78.3417122),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
WiHa_weather <- get_power(
  community = "ag",
  lonlat = c(38.021608,-78.631458),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
NoSh_weather <- get_power(
  community = "ag",
  lonlat = c(38.021608,-78.631460),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
LiBl_weather <- get_power(
  community = "ag",
  lonlat = c(38.0980496,-78.4915567),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
GwMe_weather <- get_power(
  community = "ag",
  lonlat = c(39.0444765,-77.49892),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
FrSa_weather <- get_power(
  community = "ag",
  lonlat = c(38.3967029,-78.8319075),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
AlBe_weather <- get_power(
  community = "ag",
  lonlat = c(38.146223,-79.081904),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
NaMo_weather <- get_power(
  community = "ag",
  lonlat = c(38.0653651,-78.5021388),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
AlBr_weather <- get_power(
  community = "ag",
  lonlat = c(38.036324,-78.465637),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
SiKi_weather <- get_power(
  community = "ag",
  lonlat = c(38.291869,-78.42491),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
LiHa_weather <- get_power(
  community = "ag",
  lonlat = c(37.5825066,-77.45722),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
DoSc_weather <- get_power(
  community = "ag",
  lonlat = c(38.06808,-78.473266),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
NaCa_weather <- get_power(
  community = "ag",
  lonlat = c(36.608054,-79.5244928),
  pars = c("RH2M", "T2M", "PRECTOTCORR"),
  dates = c("2021-01-01", 
            paste(2025, "-08-20", sep = "")),
  temporal_api = "daily"
)
```

```{r}
#Combine dataframes from all farms in VT
AllFarmsVT_weather <-rbind(AdamsBerry_weather, CoveredBridge_weather, FullBelly_weather, LastResort_weather, SweetRoots_weather)
```

```{r}
#Combine dataframes from all farms in KY
AllFarmsKY_weather <-rbind(CrossKeysFarm_weather, CartersMountain_weather, GreatCountryFarms_weather, LeveringOrchard_weather, CharlottesvilleAlbermarle_weather,ChilesPeachOrchard_weather)
```

```{r}
#Combine dataframes from all farms in VA
AllFarmsVA_weather <-rbind(AlBe_weather,KiBa_weather,JoNu_weather,FeAb_weather,RaPo_weather,WiHa_weather,NoSh_weather,LiBl_weather,GwMe_weather,FrSa_weather,NaMo_weather,AlBr_weather,SiKi_weather,LiHa_weather,DoSc_weather,NaCa_weather)
```

```{r}
AllFarmsTotal_weather<-rbind.data.frame(AllFarmsKY_weather, AllFarmsVT_weather, AllFarmsVA_weather)
```

#switch automatic incorrect LAT and LON column names colnames(AllFarmsVT_weather)[2] \<- "LON" colnames(AllFarmsVT_weather)[1] \<- "LAT" #switch automatic incorrect LAT and LON column names colnames(AllFarmsKY_weather)[2] \<- "LON" colnames(AllFarmsKY_weather)[1] \<- "LAT"

```{r}
#CombineLatLon data into one variable "Coordinates". LON is placed first becuase NASA data automatically downloads with LAT and LON incorrectly labled.
AllFarmsVT_weather$Coordinates<- paste(AllFarmsVT_weather$LON, AllFarmsVT_weather$LAT,sep=",")
AllFarmsKY_weather$Coordinates<- paste(AllFarmsKY_weather$LON, AllFarmsKY_weather$LAT,sep=",")
AllFarmsVA_weather$Coordinates<- paste(AllFarmsVA_weather$LON, AllFarmsVA_weather$LAT,sep=",")
AllFarmsTotal_weather$Coordinates<- paste(AllFarmsTotal_weather$LON, AllFarmsTotal_weather$LAT,sep=",")
```

```{r}
AllFarmsVT_weather$DD<-NULL
AllFarmsVT_weather$DOY<-NULL
AllFarmsKY_weather$DD<-NULL
AllFarmsKY_weather$DOY<-NULL
AllFarmsVA_weather$DD<-NULL
AllFarmsVA_weather$DOY<-NULL
AllFarmsTotal_weather$DD<-NULL
AllFarmsTotal_weather$DOY<-NULL
#save YYYYMMDD as a date 
AllFarmsTotal_weather$YYYYMMDD <- as.Date(AllFarmsTotal_weather$YYYYMMDD, format = "%Y-%m-%d")
AllFarmsVA_weather$YYYYMMDD <- as.Date(AllFarmsVA_weather$YYYYMMDD, format = "%Y-%m-%d")
AllFarmsKY_weather$YYYYMMDD <- as.Date(AllFarmsKY_weather$YYYYMMDD, format = "%Y-%m-%d")
AllFarmsVT_weather$YYYYMMDD <- as.Date(AllFarmsVT_weather$YYYYMMDD, format = "%Y-%m-%d")
SWD_data$YYYYMMDD <-as.Date(SWD_data$YYYYMMDD, format = "%Y-%m-%d")
```

```{r}
AbundanceTempVT<-merge(SWD_data, AllFarmsVT_weather, by = c("Coordinates","YYYYMMDD"))
AbundanceTempKY<-merge(SWD_data, AllFarmsKY_weather, by = c("YYYYMMDD","Coordinates"))
AbundanceTempVA<-merge(SWD_data, AllFarmsVA_weather, by = c("Coordinates","YYYYMMDD"))
AbundanceTempTotal<-merge(SWD_data, AllFarmsTotal_weather, by = c("Coordinates","YYYYMMDD"))
```

```{r}
#Ensure that variables are factor columns, rather than numeric.
AbundanceTempVT$T2M <- as.numeric(as.character(AbundanceTempVT$T2M))
AbundanceTempVT$N_swd<-as.numeric(as.character(AbundanceTempVT$N_swd))
AbundanceTempKY$T2M <- as.numeric(as.character(AbundanceTempKY$T2M))
AbundanceTempKY$N_swd<-as.numeric(as.character(AbundanceTempKY$N_swd))
AbundanceTempVA$T2M <- as.numeric(as.character(AbundanceTempVA$T2M))
AbundanceTempVA$N_swd<-as.numeric(as.character(AbundanceTempVA$N_swd))
AbundanceTempTotal$T2M <- as.numeric(as.character(AbundanceTempTotal$T2M))
AbundanceTempTotal$N_swd<-as.numeric(as.character(AbundanceTempTotal$N_swd))
```

```{r}
#create a scatter plot of PRECTOTCORR against SWD for VT
attach(AbundanceTempVT)
plot(PRECTOTCORR,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Average total precipitation at surface of Earth",
     main = "Precipitation vs SWD Population",
     pch = 21,
     bg = "darkgreen",
     col = "darkgreen",
)
#create a scatter plot of T2M against SWD
attach(AbundanceTempVT)
plot(T2M,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Tempature (degrees C)",
     main = "Temperature vs SWD Population",
     pch = 21,
     bg = "darkgreen",
     col = "darkgreen",
)
#create a scatter plot of RH2M against SWD
attach(AbundanceTempVT)
plot(RH2M,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Relative Humidity",
     main = "Relative Humidity vs SWD Population",
     pch = 21,
     bg = "darkgreen",
     col = "darkgreen",
)
```

```{r}
#create a scatter plot of PRECTOTCORR against SWD for KY
attach(AbundanceTempKY)
plot(PRECTOTCORR,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Average total precipitation at surface of Earth",
     main = "Precipitation vs SWD Population",
     pch = 21,
     bg = "darkred",
     col = "darkred",
)
#create a scatter plot of T2M against SWD
attach(AbundanceTempKY)
plot(T2M,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Tempature (degrees C)",
     main = "Temperature vs SWD Population",
     pch = 21,
     bg = "darkred",
     col = "darkred",
)
#create a scatter plot of RH2M against SWD
attach(AbundanceTempKY)
plot(RH2M,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Relative Humidity",
     main = "Relative Humidity vs SWD Population",
     pch = 21,
     bg = "darkred",
     col = "darkred",
)
```

```{r}
#create a scatter plot of PRECTOTCORR against SWD for KY
attach(AbundanceTempVA)
plot(PRECTOTCORR,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Average total precipitation at surface of Earth",
     main = "Precipitation vs SWD Population",
     pch = 21,
     bg = "orange",
     col = "orange",
)
#create a scatter plot of T2M against SWD
attach(AbundanceTempVA)
plot(T2M, N_swd,
     ylab = "Number of SWD Males",
     xlab = "Tempature (degrees C)",
     main = "Temperature vs SWD Population",
     pch = 21,
     bg = "orange",
     col = "orange",
)
#create a scatter plot of RH2M against SWD
attach(AbundanceTempVA)
plot(RH2M,N_swd,
     ylab = "Number of SWD Males",
     xlab = "Relative Humidity",
     main = "Relative Humidity vs SWD Population",
     pch = 21,
     bg = "orange",
     col = "orange",
)
```

```{r}
#create a scatter plot of PRECTOTCORR against SWD for All Farms 
attach(AbundanceTempTotal)
plot(PRECTOTCORR, N_swd,
     ylab = "Number of SWD Males",
     xlab = "Average total precipitation at surface of Earth",
     main = "Precipitation vs SWD Population",
     pch = 21,
     bg = "salmon",
     col = "salmon",
)
#create a scatter plot of T2M against SWD
attach(AbundanceTempTotal)
plot(T2M, N_swd,
     ylab = "Number of SWD Males",
     xlab = "Tempature (degrees C)",
     main = "Temperature vs SWD Population",
     pch = 21,
     bg = "salmon",
     col = "salmon",
)
#create a scatter plot of RH2M against SWD
attach(AbundanceTempTotal)
plot(RH2M, N_swd,
     ylab = "Number of SWD Males",
     xlab = "Relative Humidity",
     main = "Relative Humidity vs SWD Population",
     pch = 21,
     bg = "salmon",
     col = "salmon",
)
```

```{r}
library(ggplot2)
#make a ggplot line chart to plot population over time
#NEED TO FIGURE OUT HOW TO REMOVE OUTLIER
ggplot(AbundanceTempTotal, aes(x = YYYYMMDD, y = N_swd)) +
  geom_line() +
  labs(title = "Population Over Time", x = "Year", y = "Population Count") +
  theme_minimal()
```

```{r}
VTswd_interpolated<-approx(y = N_swd, x = YYYYMMDD, method = "linear", n = 50,
          rule = 1, f = 0, ties = mean, na.rm = TRUE)
```

```{r}
ccf(SWD_data$YYYYMMDD,VTswd_interpolated[["y"]], lag.max = NULL, type = c("correlation", "covariance"),
    plot = TRUE, na.action = na.fail,
    main = "SWD Population & Time cross-correlation")
```
